<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FreelanceFlow | Availability</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
  <style>
    .smooth-transition { transition: all 0.3s ease; }
    .sidebar { transition: transform 0.3s ease; }
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        position: fixed;
        z-index: 50;
        height: 100vh;
      }
      .sidebar.open { transform: translateX(0); }
    }
    .fc-daygrid-day-frame { min-height: 100px; }
    .fc-event { cursor: pointer; font-size: 0.85em; padding: 2px 5px; }
    .fc-timegrid-slots td { height: 40px; }
  </style>
</head>
<body class="bg-gray-50 font-sans">

  <!-- Navbar -->
  <nav class="bg-white shadow-sm fixed w-full z-10">
    <!-- mismo navbar -->
  </nav>

  <!-- Sidebar -->
  <div class="sidebar bg-white w-64 fixed h-full shadow-md overflow-y-auto">
    <!-- copiar sidebar y marcar Availability activo -->
  </div>

  <!-- Main Content -->
  <div class="md:ml-64 pt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8">

      <!-- Heading -->
      <div class="py-6 flex justify-between items-center">
        <h1 class="text-2xl font-semibold text-gray-900">Availability</h1>
        <button id="add-availability" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">
          <i class="fas fa-plus mr-2"></i> Add Slot
        </button>
      </div>
      <p class="mt-1 text-sm text-gray-500">Manage your available time slots for appointments</p>

      <!-- Calendar -->
      <div class="bg-white shadow rounded-lg overflow-hidden mb-8">
        <div id="availability-calendar" class="p-4"></div>
      </div>

      <!-- Recurring Availability -->
      <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
          <h3 class="text-lg font-medium text-gray-900">Recurring Availability</h3>
          <p class="mt-1 text-sm text-gray-500">Your weekly recurring availability patterns</p>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Day</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time Slot</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody id="recurring-availability" class="bg-white divide-y divide-gray-200">
              <tr>
                <td colspan="3" class="px-6 py-4 text-center text-gray-500">No recurring availability set</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Availability Modal -->
  <div id="availability-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-lg mx-4 overflow-hidden">
        <!-- Header -->
        <div class="px-4 py-3 border-b flex justify-between items-center">
        <h2 class="text-lg font-semibold text-gray-800">Agregar / Editar disponibilidad</h2>
        <button id="close-availability-modal" class="text-gray-500 hover:text-gray-700 focus:outline-none">
            <i class="fas fa-times"></i>
        </button>
        </div>
        <!-- Form -->
        <form id="availability-form" class="px-6 py-4 space-y-4">
        <div>
            <label for="start-time" class="block text-sm font-medium text-gray-700">Hora de inicio</label>
            <input type="time" id="start-time" name="startTime"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
        </div>
        <div>
            <label for="end-time" class="block text-sm font-medium text-gray-700">Hora de fin</label>
            <input type="time" id="end-time" name="endTime"
                class="mt-1 block w-full border border-gray-300 rounded-md p-2" required>
        </div>
        <div class="flex items-center space-x-2">
            <input type="checkbox" id="recurring" name="recurring"
                class="h-4 w-4 text-indigo-600 border-gray-300 rounded">
            <label for="recurring" class="text-sm text-gray-700">Recurrente</label>
        </div>
        <div id="day-of-week-container" class="hidden">
            <label for="dayOfWeek" class="block text-sm font-medium text-gray-700">Día de la semana</label>
            <select id="dayOfWeek" name="dayOfWeek"
                    class="mt-1 block w-full border border-gray-300 rounded-md p-2">
            <option value="0">Domingo</option>
            <option value="1">Lunes</option>
            <option value="2">Martes</option>
            <option value="3">Miércoles</option>
            <option value="4">Jueves</option>
            <option value="5">Viernes</option>
            <option value="6">Sábado</option>
            </select>
        </div>
        <div class="flex justify-end space-x-2 pt-4 border-t">
            <button type="button" id="save-availability"
                    class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
            Guardar
            </button>
            <button type="button" id="cancel-availability"
                    class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">
            Cancelar
            </button>
        </div>
        </form>
    </div>
  </div>

  <script type="module">
    document.addEventListener('DOMContentLoaded', () => {
        const modal       = document.getElementById('availability-modal');
        const closeBtn    = document.getElementById('close-availability-modal');
        const cancelBtn   = document.getElementById('cancel-availability');
        const recurring   = document.getElementById('recurring');
        const dayContainer= document.getElementById('day-of-week-container');

        // Cierra el modal
        closeBtn.addEventListener('click', () => modal.classList.add('hidden'));
        cancelBtn.addEventListener('click', () => modal.classList.add('hidden'));
        modal.addEventListener('click', e => {
        if (e.target === modal) modal.classList.add('hidden');
        });

        // Mostrar/ocultar selector de día cuando es recurrente
        recurring.addEventListener('change', () => {
        dayContainer.classList.toggle('hidden', !recurring.checked);
        });
    });
   </script>


  <script type="module">
    import { initAvailability } from '/assets/js/modules/availability.js';
    import { getCurrentUser, logout } from '/assets/js/auth.js';

    document.addEventListener('DOMContentLoaded', async () => {
      // idéntico setup de navbar/sidebar...
      // Load user
      const user = getCurrentUser();
      if (!user) { window.location.href = '/login.html'; return; }
      // actualiza nombre/avatar...
      // Inicializa disponibilidad
      initAvailability();
    });
  </script>
</body>
</html>
