<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreelanceFlow - Professional Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .fc-daygrid-day-frame { min-height: 100px; }
        .fc-event { cursor: pointer; }
        .smooth-transition { transition: all 0.3s ease; }
        .sidebar { transition: transform 0.3s ease; }
        .fc-timegrid-slots td {
            height: 40px;
        }
        .fc-event {
            font-size: 0.85em;
            padding: 2px 5px;
        }
        .fc-daygrid-event {
            margin: 1px 2px;
        }
        .fc-daygrid-day-frame {
            min-height: 80px;
        }
        .modal {
            z-index: 1000;
        }
        @media (max-width: 768px) {
            .sidebar { 
                transform: translateX(-100%); 
                position: fixed; 
                z-index: 50; 
                height: 100vh; 
            }
            .sidebar.open { transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navbar -->
    <nav class="bg-white shadow-sm fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <button id="mobile-menu-button" class="md:hidden text-gray-500 hover:text-gray-700">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div class="flex-shrink-0 flex items-center">
                        <img class="h-8 w-auto" src="https://via.placeholder.com/150x50?text=FreelanceFlow" alt="FreelanceFlow">
                    </div>
                </div>
                <div class="flex items-center">
                    <div class="ml-4 flex items-center md:ml-6">
                        <button type="button" class="bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <span class="sr-only">View notifications</span>
                            <div class="relative">
                                <i class="far fa-bell text-xl"></i>
                                <span class="absolute -top-1 -right-1 h-4 w-4 rounded-full bg-red-500 text-white text-xs flex items-center justify-center">3</span>
                            </div>
                        </button>

                        <!-- Profile dropdown -->
                        <div class="ml-3 relative">
                            <div>
                                <button id="user-menu-button" class="max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    <span class="sr-only">Open user menu</span>
                                    <img class="h-8 w-8 rounded-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                                    <span class="ml-2 hidden md:inline-block" id="user-name">Loading...</span>
                                </button>
                            </div>
                            <div class="origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden" role="menu">
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="profile-btn">Your Profile</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="settings-btn">Settings</a>
                                <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" id="logout-btn">Sign out</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Sidebar -->
    <div class="sidebar bg-white w-64 fixed h-full shadow-md overflow-y-auto">
        <div class="flex items-center justify-center h-16 border-b">
            <span class="text-xl font-semibold text-gray-700">FreelanceFlow</span>
        </div>
        <div class="mt-6 px-4">
            <div class="flex items-center px-4 py-3 bg-indigo-50 rounded-lg">
                <img class="h-10 w-10 rounded-full" id="user-avatar" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                <div class="ml-3">
                    <p class="text-sm font-medium text-gray-700" id="sidebar-user-name">Loading...</p>
                    <p class="text-xs text-gray-500">Professional</p>
                </div>
            </div>
        </div>
        <nav class="mt-6">
            <div>
                <a href="#" class="flex items-center px-6 py-3 text-sm font-medium text-indigo-700 bg-indigo-50 border-l-4 border-indigo-500">
                    <i class="fas fa-tachometer-alt mr-3 text-indigo-500"></i>
                    Dashboard
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50">
                    <i class="far fa-calendar-alt mr-3 text-gray-500"></i>
                    Appointments
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50">
                    <i class="fas fa-users mr-3 text-gray-500"></i>
                    Clients
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50">
                    <i class="fas fa-tasks mr-3 text-gray-500"></i>
                    Services
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50">
                    <i class="far fa-clock mr-3 text-gray-500"></i>
                    Availability
                </a>
                <a href="#" class="flex items-center px-6 py-3 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50">
                    <i class="far fa-star mr-3 text-gray-500"></i>
                    Reviews
                </a>
            </div>
            <div class="px-6 py-4 border-t mt-4">
                <p class="text-xs font-medium text-gray-500 uppercase tracking-wider">Settings</p>
                <a href="#" class="flex items-center px-2 py-2 mt-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md" id="sidebar-profile-btn">
                    <i class="fas fa-user mr-3 text-gray-500"></i>
                    Profile
                </a>
                <a href="#" class="flex items-center px-2 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md" id="sidebar-settings-btn">
                    <i class="fas fa-cog mr-3 text-gray-500"></i>
                    Settings
                </a>
                <a href="#" class="flex items-center px-2 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 rounded-md" id="sidebar-logout-btn">
                    <i class="fas fa-sign-out-alt mr-3 text-gray-500"></i>
                    Sign Out
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="md:ml-64 pt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 md:px-8">
            <!-- Page Heading -->
            <div class="py-6">
                <h1 class="text-2xl font-semibold text-gray-900">Dashboard</h1>
                <p class="mt-1 text-sm text-gray-500" id="welcome-message">Welcome back! Here's what's happening today.</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8" id="stats-cards">
                <!-- Stats will be loaded here -->
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Left Column -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- Upcoming Appointments -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">
                                Upcoming Appointments
                            </h3>
                            <p class="mt-1 text-sm text-gray-500">
                                Your next 5 appointments
                            </p>
                        </div>
                        <div class="bg-white overflow-hidden">
                            <ul class="divide-y divide-gray-200" id="upcoming-appointments">
                                <!-- Appointments will be loaded here -->
                                <li class="p-4 text-center text-gray-500">
                                    Loading appointments...
                                </li>
                            </ul>
                        </div>
                        <div class="px-4 py-4 bg-gray-50 text-right sm:px-6">
                            <button type="button" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                View All Appointments
                            </button>
                        </div>
                    </div>

                    <!-- Availability Calendar -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900">
                                    My Availability
                                </h3>
                                <button type="button" class="inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="add-availability-btn">
                                    <i class="fas fa-plus mr-1"></i> Add Slot
                                </button>
                            </div>
                            <p class="mt-1 text-sm text-gray-500">
                                Manage your available time slots for appointments
                            </p>
                        </div>
                        <div class="p-4">
                            <div id="availability-calendar"></div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="space-y-8">
                    <!-- Recent Reviews -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                            <h3 class="text-lg leading-6 font-medium text-gray-900">
                                Recent Reviews
                            </h3>
                            <p class="mt-1 text-sm text-gray-500">
                                What your clients are saying
                            </p>
                        </div>
                        <div class="bg-white overflow-hidden">
                            <ul class="divide-y divide-gray-200" id="recent-reviews">
                                <!-- Reviews will be loaded here -->
                                <li class="p-4 text-center text-gray-500">
                                    Loading reviews...
                                </li>
                            </ul>
                        </div>
                        <div class="px-4 py-4 bg-gray-50 text-right sm:px-6">
                            <button type="button" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                View All Reviews
                            </button>
                        </div>
                    </div>

                    <!-- My Services -->
                    <div class="bg-white shadow rounded-lg overflow-hidden">
                        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h3 class="text-lg leading-6 font-medium text-gray-900">
                                    My Services
                                </h3>
                                <button type="button" class="inline-flex items-center px-3 py-1 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" id="add-service-btn">
                                    <i class="fas fa-plus mr-1"></i> Add Service
                                </button>
                            </div>
                            <p class="mt-1 text-sm text-gray-500">
                                Services you offer to clients
                            </p>
                        </div>
                        <div class="bg-white overflow-hidden">
                            <ul class="divide-y divide-gray-200" id="my-services">
                                <!-- Services will be loaded here -->
                                <li class="p-4 text-center text-gray-500">
                                    Loading services...
                                </li>
                            </ul>
                        </div>
                        <div class="px-4 py-4 bg-gray-50 text-right sm:px-6">
                            <button type="button" class="inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Manage All Services
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Availability Modal -->
    <div id="availability-modal" class="fixed z-50 inset-0 overflow-y-auto hidden">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <i class="fas fa-clock text-indigo-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Add Availability Slot
                        </h3>
                        <div class="mt-2">
                            <form id="availability-form">
                                <div class="space-y-4">
                                    <div>
                                        <label for="day-of-week" class="block text-sm font-medium text-gray-700">Day of Week</label>
                                        <select id="day-of-week" name="dayOfWeek" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                            <option value="monday">Monday</option>
                                            <option value="tuesday">Tuesday</option>
                                            <option value="wednesday">Wednesday</option>
                                            <option value="thursday">Thursday</option>
                                            <option value="friday">Friday</option>
                                            <option value="saturday">Saturday</option>
                                            <option value="sunday">Sunday</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="start-time" class="block text-sm font-medium text-gray-700">Start Time</label>
                                        <input type="time" id="start-time" name="startTime" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="end-time" class="block text-sm font-medium text-gray-700">End Time</label>
                                        <input type="time" id="end-time" name="endTime" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div class="flex items-center">
                                        <input id="is-recurring" name="isRecurring" type="checkbox" class="focus:ring-indigo-500 h-4 w-4 text-indigo-600 border-gray-300 rounded">
                                        <label for="is-recurring" class="ml-2 block text-sm text-gray-700">
                                            Recurring weekly
                                        </label>
                                    </div>
                                    <div id="date-range-fields" class="hidden space-y-4">
                                        <div>
                                            <label for="valid-from" class="block text-sm font-medium text-gray-700">Valid From</label>
                                            <input type="date" id="valid-from" name="validFrom" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>
                                        <div>
                                            <label for="valid-to" class="block text-sm font-medium text-gray-700">Valid To (optional)</label>
                                            <input type="date" id="valid-to" name="validTo" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                    <button type="button" id="save-availability" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">
                        Save Availability
                    </button>
                    <button type="button" id="cancel-availability-modal" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Service Modal -->
    <div id="service-modal" class="fixed z-50 inset-0 overflow-y-auto hidden">
        <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <i class="fas fa-tasks text-indigo-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Add New Service
                        </h3>
                        <div class="mt-2">
                            <form id="service-form">
                                <div class="space-y-4">
                                    <div>
                                        <label for="service-name" class="block text-sm font-medium text-gray-700">Service Name</label>
                                        <input type="text" id="service-name" name="name" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="service-description" class="block text-sm font-medium text-gray-700">Description</label>
                                        <textarea id="service-description" name="description" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                                    </div>
                                    <div>
                                        <label for="service-price" class="block text-sm font-medium text-gray-700">Price per hour ($)</label>
                                        <input type="number" id="service-price" name="price" min="0" step="0.01" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="base-duration" class="block text-sm font-medium text-gray-700">Base Duration (minutes)</label>
                                        <input type="number" id="base-duration" name="baseDuration" min="15" step="15" value="30" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="duration-increment" class="block text-sm font-medium text-gray-700">Duration Increment (minutes)</label>
                                        <input type="number" id="duration-increment" name="durationIncrement" min="15" step="15" value="30" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="max-duration" class="block text-sm font-medium text-gray-700">Maximum Duration (minutes)</label>
                                        <input type="number" id="max-duration" name="maxDuration" min="30" step="15" value="120" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                    <button type="button" id="save-service" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">
                        Save Service
                    </button>
                    <button type="button" id="cancel-service-modal" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="fixed z-50 inset-0 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-indigo-100">
                        <i class="fas fa-user-edit text-indigo-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">
                            Edit Profile
                        </h3>
                        <div class="mt-4">
                            <form id="profile-form">
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label for="first-name" class="block text-sm font-medium text-gray-700">First Name</label>
                                        <input type="text" id="first-name" name="firstName" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="last-name" class="block text-sm font-medium text-gray-700">Last Name</label>
                                        <input type="text" id="last-name" name="lastName" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                                    <input type="email" id="email" name="email" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700">Profile Picture</label>
                                    <div class="mt-2 flex items-center">
                                        <span class="inline-block h-12 w-12 rounded-full overflow-hidden bg-gray-100">
                                            <img id="profile-avatar-preview" class="h-full w-full" src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80" alt="">
                                        </span>
                                        <label for="avatar-upload" class="ml-5 cursor-pointer bg-white py-2 px-3 border border-gray-300 rounded-md shadow-sm text-sm leading-4 font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            Change
                                            <input id="avatar-upload" type="file" class="sr-only" accept="image/*">
                                        </label>
                                    </div>
                                </div>
                                
                                <div id="professional-fields" class="space-y-4 border-t pt-4">
                                    <div>
                                        <label for="profession" class="block text-sm font-medium text-gray-700">Profession</label>
                                        <input type="text" id="profession" name="profession" class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md">
                                    </div>
                                    <div>
                                        <label for="bio" class="block text-sm font-medium text-gray-700">Bio</label>
                                        <textarea id="bio" name="bio" rows="3" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md"></textarea>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                    <button type="button" id="cancel-profile-modal" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">
                        Cancel
                    </button>
                    <button type="button" id="save-profile" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">
                        Save Changes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Appointment Details Modal -->
    <div id="appointment-modal" class="fixed z-50 inset-0 overflow-y-auto hidden">
        <div class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
            <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
            </div>
            <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
            <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
                <div>
                    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100">
                        <i class="fas fa-calendar-check text-blue-600"></i>
                    </div>
                    <div class="mt-3 text-center sm:mt-5">
                        <h3 class="text-lg leading-6 font-medium text-gray-900" id="appointment-title">
                            Appointment Details
                        </h3>
                        <div class="mt-4">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p class="font-medium text-gray-500">Client:</p>
                                        <p id="appointment-client" class="mt-1 text-gray-900">-</p>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-500">Service:</p>
                                        <p id="appointment-service" class="mt-1 text-gray-900">-</p>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-500">Date:</p>
                                        <p id="appointment-date" class="mt-1 text-gray-900">-</p>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-500">Time:</p>
                                        <p id="appointment-time" class="mt-1 text-gray-900">-</p>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-500">Duration:</p>
                                        <p id="appointment-duration" class="mt-1 text-gray-900">-</p>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-500">Status:</p>
                                        <p id="appointment-status" class="mt-1">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                Pending
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <p class="font-medium text-gray-500">Notes:</p>
                                    <p id="appointment-notes" class="mt-1 text-gray-900 text-sm">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-5 sm:mt-6 sm:grid sm:grid-cols-2 sm:gap-3 sm:grid-flow-row-dense">
                    <button type="button" id="cancel-appointment-modal" class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:col-start-1 sm:text-sm">
                        Close
                    </button>
                    <button type="button" id="change-status-btn" class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:col-start-2 sm:text-sm">
                        Confirm Appointment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
                /* ─────────── Imports ─────────── */
        import { usersAPI, professionalsAPI, servicesAPI } from '../../../assets/js/api.js';
        import { getLoggedUser, clearAuth }                from '../../../assets/utils/auth.js';

        /* ─────────── Variables globales ─────────── */
        let currentUser   = null;
        let professionalId = null;
        let calendar      = null;

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize UI components
            initMobileMenu();
            initUserDropdown();
            initModals();
            
            // Load user data and dashboard content
            loadUserData().then(() => {
                if (professionalId) {
                    loadDashboardStats();
                    loadUpcomingAppointments();
                    loadProfessionalServices();
                    loadProfessionalReviews();
                    initCalendar();
                }
            });
        });

        // Initialize mobile menu toggle
        function initMobileMenu() {
            document.getElementById('mobile-menu-button').addEventListener('click', function() {
                document.querySelector('.sidebar').classList.toggle('open');
            });
        }

        // Initialize user dropdown toggle
        function initUserDropdown() {
            document.getElementById('user-menu-button').addEventListener('click', function() {
                document.querySelector('[role="menu"]').classList.toggle('hidden');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (!event.target.closest('#user-menu-button') && !event.target.closest('[role="menu"]')) {
                    document.querySelector('[role="menu"]').classList.add('hidden');
                }
            });
        }

        // Initialize all modals
        function initModals() {
            // Availability modal
            document.getElementById('add-availability-btn').addEventListener('click', function() {
                document.getElementById('availability-modal').classList.remove('hidden');
            });

            document.getElementById('cancel-availability-modal').addEventListener('click', function() {
                document.getElementById('availability-modal').classList.add('hidden');
            });

            document.getElementById('is-recurring').addEventListener('change', function(e) {
                document.getElementById('date-range-fields').classList.toggle('hidden', !e.target.checked);
            });

            // Service modal
            document.getElementById('add-service-btn').addEventListener('click', function() {
                resetServiceForm();
                document.getElementById('service-modal').classList.remove('hidden');
            });

            document.getElementById('cancel-service-modal').addEventListener('click', function() {
                document.getElementById('service-modal').classList.add('hidden');
            });

            // Profile modal
            document.getElementById('profile-btn').addEventListener('click', openProfileModal);
            document.getElementById('sidebar-profile-btn').addEventListener('click', openProfileModal);
            document.getElementById('sidebar-settings-btn').addEventListener('click', openProfileModal);
            document.getElementById('settings-btn').addEventListener('click', openProfileModal);
            
            document.getElementById('cancel-profile-modal').addEventListener('click', function() {
                document.getElementById('profile-modal').classList.add('hidden');
            });

            // Appointment modal
            document.getElementById('cancel-appointment-modal').addEventListener('click', function() {
                document.getElementById('appointment-modal').classList.add('hidden');
            });

            // Avatar upload
            document.getElementById('avatar-upload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('profile-avatar-preview').src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Save buttons
            document.getElementById('save-availability').addEventListener('click', saveAvailability);
            document.getElementById('save-service').addEventListener('click', saveService);
            document.getElementById('save-profile').addEventListener('click', saveProfile);

            // Logout buttons
            document.getElementById('logout-btn').addEventListener('click', logout);
            document.getElementById('sidebar-logout-btn').addEventListener('click', logout);
        }

        function initCalendar() {
            const calendarEl = document.getElementById('availability-calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'timeGridWeek',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                allDaySlot: false,
                slotDuration: '00:30:00',
                slotMinTime: '08:00:00',
                slotMaxTime: '20:00:00',
                height: 'auto',
                nowIndicator: true,
                editable: true,
                selectable: true,
                eventOverlap: false,
                events: async function(fetchInfo, successCallback) {
                    try {
                        const [availabilityRes, appointmentsRes] = await Promise.all([
                            fetch(`/api/professionals/${professionalId}/availability?start=${fetchInfo.startStr}&end=${fetchInfo.endStr}`, {
                                headers: {
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                                }
                            }),
                            fetch(`/api/professionals/${professionalId}/appointments?start=${fetchInfo.startStr}&end=${fetchInfo.endStr}`, {
                                headers: {
                                    'Authorization': `Bearer ${localStorage.getItem('token')}`
                                }
                            })
                        ]);

                        if (!availabilityRes.ok || !appointmentsRes.ok) {
                            throw new Error('Failed to load data');
                        }

                        const availability = await availabilityRes.json();
                        const appointments = await appointmentsRes.json();

                        const events = [];

                        // Process availability slots
                        availability.forEach(slot => {
                            events.push({
                                title: 'Available',
                                start: slot.startTime,
                                end: slot.endTime,
                                daysOfWeek: slot.recurring ? [getDayOfWeekNumber(slot.dayOfWeek)] : undefined,
                                color: '#10B981',
                                display: 'background',
                                extendedProps: {
                                    type: 'availability',
                                    id: slot.id,
                                    recurring: slot.recurring
                                }
                            });
                        });

                        // Process appointments
                        appointments.forEach(appt => {
                            events.push({
                                title: appt.clientName || `Appointment - ${appt.serviceName || ''}`,
                                start: appt.startTime,
                                end: appt.endTime,
                                color: '#3B82F6',
                                extendedProps: {
                                    type: 'appointment',
                                    id: appt.id,
                                    clientName: appt.clientName,
                                    serviceName: appt.serviceName,
                                    status: appt.status,
                                    notes: appt.notes
                                }
                            });
                        });

                        successCallback(events);
                    } catch (error) {
                        console.error('Error loading calendar data:', error);
                        showToast('Error loading calendar', 'error');
                    }
                },
                eventClick: function(info) {
                    const event = info.event;
                    if (event.extendedProps.type === 'appointment') {
                        showAppointmentDetails(event);
                    } else {
                        showAvailabilityDetails(event);
                    }
                },
                eventDrop: async function(info) {
                    try {
                        const response = await fetch(`/api/appointments/${info.event.extendedProps.id}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${localStorage.getItem('token')}`
                            },
                            body: JSON.stringify({
                                startTime: info.event.start.toISOString(),
                                endTime: info.event.end.toISOString()
                            })
                        });

                        if (!response.ok) {
                            throw new Error('Failed to update appointment');
                        }
                        showToast('Appointment updated', 'success');
                    } catch (error) {
                        console.error(error);
                        info.revert();
                        showToast(error.message, 'error');
                    }
                }
            });

            calendar.render();
        }

        // Helper for days of week
        function getDayOfWeekNumber(dayName) {
            const days = {
                'monday': 1,
                'tuesday': 2,
                'wednesday': 3,
                'thursday': 4,
                'friday': 5,
                'saturday': 6,
                'sunday': 0
            };
            return days[dayName.toLowerCase()] || 1;
        }

       async function loadUserData () {
            try {
                const user = await usersAPI.getCurrentUser();      // usa tu wrapper
                currentUser    = user;
                professionalId = user.role === 'professional' ? user.id : user.professionalInfo?.professionalId;

                if (!professionalId) throw new Error('professionalId not found');

                /* ------ pinta datos en la UI ------ */
                const fullName = `${user.firstName} ${user.lastName}`;
                document.getElementById('user-name').textContent         = fullName;
                document.getElementById('sidebar-user-name').textContent = fullName;
                document.getElementById('welcome-message').textContent   = `Welcome back, ${user.firstName}!`;

                const avatarSrc = user.profilePicture ||
                `https://ui-avatars.com/api/?background=667eea&color=fff&name=${encodeURIComponent(user.firstName[0]+user.lastName[0])}`;

                document.getElementById('user-avatar').src            = avatarSrc;
                document.getElementById('profile-avatar-preview').src = avatarSrc;

                
                await loadDashboardStats();
                await loadProfessionalServices();
            } catch (err) {
                console.error(err);
                clearAuth();
                location.href = '../login.html';
            }
            }

        // Load dashboard stats
        async function loadDashboardStats() {
            try {
                const response = await fetch(`/api/professionals/${professionalId}/stats`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                const stats = await response.json();
                
                // Render stats cards
                const statsContainer = document.getElementById('stats-cards');
                statsContainer.innerHTML = `
                    <!-- Total Appointments -->
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                                    <i class="fas fa-calendar-alt text-white"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dt class="text-sm font-medium text-gray-500 truncate">
                                        Total Appointments
                                    </dt>
                                    <dd class="flex items-baseline">
                                        <div class="text-2xl font-semibold text-gray-900">
                                            ${stats.totalAppointments || 0}
                                        </div>
                                    </dd>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Earnings -->
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                                    <i class="fas fa-dollar-sign text-white"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dt class="text-sm font-medium text-gray-500 truncate">
                                        Total Earnings
                                    </dt>
                                    <dd class="flex items-baseline">
                                        <div class="text-2xl font-semibold text-gray-900">
                                            $${stats.totalEarnings ? stats.totalEarnings.toFixed(2) : '0.00'}
                                        </div>
                                    </dd>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Average Rating -->
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-yellow-500 rounded-md p-3">
                                    <i class="fas fa-star text-white"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dt class="text-sm font-medium text-gray-500 truncate">
                                        Average Rating
                                    </dt>
                                    <dd class="flex items-baseline">
                                        <div class="text-2xl font-semibold text-gray-900">
                                            ${stats.averageRating ? stats.averageRating.toFixed(1) : '0.0'}
                                        </div>
                                        <div class="flex ml-2">
                                            ${renderStars(stats.averageRating || 0)}
                                        </div>
                                    </dd>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Upcoming Appointments -->
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <div class="flex items-center">
                                <div class="flex-shrink-0 bg-blue-500 rounded-md p-3">
                                    <i class="fas fa-clock text-white"></i>
                                </div>
                                <div class="ml-5 w-0 flex-1">
                                    <dt class="text-sm font-medium text-gray-500 truncate">
                                        Upcoming Today
                                    </dt>
                                    <dd class="text-2xl font-semibold text-gray-900">
                                        ${stats.upcomingToday || 0}
                                    </dd>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
                document.getElementById('stats-cards').innerHTML = `
                    <div class="col-span-4 bg-white p-4 rounded-lg shadow text-center text-red-500">
                        Error loading statistics. Please try again later.
                    </div>
                `;
            }
        }

        // Helper function to render star ratings
        function renderStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 1; i <= 5; i++) {
                if (i <= fullStars) {
                    stars += '<i class="fas fa-star text-yellow-400"></i>';
                } else if (i === fullStars + 1 && hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt text-yellow-400"></i>';
                } else {
                    stars += '<i class="far fa-star text-yellow-400"></i>';
                }
            }
            
            return stars;
        }

        // Load upcoming appointments
        async function loadUpcomingAppointments() {
            try {
                const response = await fetch(`/api/professionals/${professionalId}/appointments?upcoming=true&limit=5`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                const appointments = await response.json();
                
                const container = document.getElementById('upcoming-appointments');
                
                if (appointments.length === 0) {
                    container.innerHTML = '<li class="p-4 text-center text-gray-500">No upcoming appointments</li>';
                    return;
                }
                
                container.innerHTML = appointments.map(appt => `
                    <li class="p-4 hover:bg-gray-50 smooth-transition">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 ${getAppointmentColorClass(appt)} rounded-lg p-3">
                                <i class="${getAppointmentIcon(appt)} ${getAppointmentTextColor(appt)}"></i>
                            </div>
                            <div class="ml-4 flex-1">
                                <div class="flex items-center justify-between">
                                    <h4 class="text-sm font-medium text-gray-900">${appt.serviceName} with ${appt.clientName}</h4>
                                    <span class="text-xs ${getStatusBadgeClass(appt)} px-2 py-1 rounded-full">
                                        ${appt.status}
                                    </span>
                                </div>
                                <div class="mt-1 flex items-center text-sm text-gray-500">
                                    <i class="far fa-clock mr-1"></i>
                                    <span>${formatAppointmentDate(appt.startTime)} - ${formatTime(appt.endTime)}</span>
                                </div>
                            </div>
                        </div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Error loading upcoming appointments:', error);
                document.getElementById('upcoming-appointments').innerHTML = 
                    '<li class="p-4 text-center text-gray-500">Error loading appointments</li>';
            }
        }

        // Helper functions for appointments
        function getAppointmentColorClass(appt) {
            const status = appt.status.toLowerCase();
            if (status === 'confirmed') return 'bg-green-100';
            if (status === 'pending') return 'bg-blue-100';
            if (status === 'cancelled') return 'bg-red-100';
            if (status === 'completed') return 'bg-purple-100';
            return 'bg-gray-100';
        }

        function getAppointmentTextColor(appt) {
            const status = appt.status.toLowerCase();
            if (status === 'confirmed') return 'text-green-600';
            if (status === 'pending') return 'text-blue-600';
            if (status === 'cancelled') return 'text-red-600';
            if (status === 'completed') return 'text-purple-600';
            return 'text-gray-600';
        }

        function getAppointmentIcon(appt) {
            const serviceType = appt.serviceName.toLowerCase();
            if (serviceType.includes('consultation')) return 'fas fa-calendar-day';
            if (serviceType.includes('video')) return 'fas fa-video';
            if (serviceType.includes('call') || serviceType.includes('phone')) return 'fas fa-phone-alt';
            if (serviceType.includes('code')) return 'fas fa-laptop-code';
            return 'fas fa-calendar-check';
        }

        function getStatusBadgeClass(appt) {
            const status = appt.status.toLowerCase();
            if (status === 'confirmed') return 'bg-green-100 text-green-800';
            if (status === 'pending') return 'bg-blue-100 text-blue-800';
            if (status === 'cancelled') return 'bg-red-100 text-red-800';
            if (status === 'completed') return 'bg-purple-100 text-purple-800';
            return 'bg-gray-100 text-gray-800';
        }

        function formatAppointmentDate(dateTime) {
            const date = new Date(dateTime);
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (date.toDateString() === today.toDateString()) {
                return `Today, ${formatTime(dateTime)}`;
            } else if (date.toDateString() === tomorrow.toDateString()) {
                return `Tomorrow, ${formatTime(dateTime)}`;
            } else {
                return `${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}, ${formatTime(dateTime)}`;
            }
        }

        function formatTime(dateTime) {
            const date = new Date(dateTime);
            return date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
        }

        // Load professional services
        async function loadProfessionalServices () {
            try {
                const services = await professionalsAPI.getServices(professionalId);

                const container = document.getElementById('my-services');
                if (!services.length) {
                container.innerHTML = '<li class="p-4 text-center text-gray-500">No services found</li>';
                return;
                }

                container.innerHTML = services.map(s => `
                <li class="p-4 hover:bg-gray-50 smooth-transition">
                    <div class="flex items-start justify-between">
                    <div>
                        <h4 class="text-sm font-medium text-gray-900">${s.Name}</h4>
                        <div class="mt-1 text-sm text-gray-500">
                        <p>${s.Description || 'No description'}</p>
                        </div>
                        <div class="mt-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                            $${(s.Price ?? 0).toFixed(2)}/hour
                        </span>
                        <span class="ml-1 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                            ${s.BaseDuration} min base
                        </span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        <button class="text-gray-400 hover:text-indigo-600 edit-service" data-id="${s.ServiceId}">
                        <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-gray-400 hover:text-red-600 delete-service" data-id="${s.ServiceId}">
                        <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                    </div>
                </li>
                `).join('');

                /* listeners */
                container.querySelectorAll('.edit-service').forEach(btn =>
                btn.onclick = () => editService(btn.dataset.id));

                container.querySelectorAll('.delete-service').forEach(btn =>
                btn.onclick = () => deleteService(btn.dataset.id));

            } catch (err) {
                console.error(err);
                document.getElementById('my-services').innerHTML =
                '<li class="p-4 text-center text-gray-500">Error loading services</li>';
            }
            }

        // Load professional reviews
        async function loadProfessionalReviews() {
            try {
                const response = await fetch(`/api/professionals/${professionalId}/reviews?limit=3`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                const reviews = await response.json();
                
                const container = document.getElementById('recent-reviews');
                
                if (reviews.length === 0) {
                    container.innerHTML = '<li class="p-4 text-center text-gray-500">No reviews yet</li>';
                    return;
                }
                
                container.innerHTML = reviews.map(review => `
                    <li class="p-4 hover:bg-gray-50 smooth-transition">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <img class="h-10 w-10 rounded-full" src="${review.client.profilePicture || 'https://via.placeholder.com/40'}" alt="">
                            </div>
                            <div class="ml-4 flex-1">
                                <div class="flex items-center justify-between">
                                    <h4 class="text-sm font-medium text-gray-900">${review.client.firstName} ${review.client.lastName}</h4>
                                    <div class="flex">
                                        ${renderStars(review.rating)}
                                    </div>
                                </div>
                                <div class="mt-1 text-sm text-gray-500">
                                    <p>${review.comments || 'No comments'}</p>
                                </div>
                                <div class="mt-2 text-xs text-gray-400">
                                    <i class="far fa-clock mr-1"></i> ${formatReviewDate(review.createdAt)}
                                </div>
                            </div>
                        </div>
                    </li>
                `).join('');
            } catch (error) {
                console.error('Error loading professional reviews:', error);
                document.getElementById('recent-reviews').innerHTML = 
                    '<li class="p-4 text-center text-gray-500">Error loading reviews</li>';
            }
        }

        function formatReviewDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 7) return `${diffDays} days ago`;
            if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        // Save availability slot
        async function saveAvailability() {
            const form = document.getElementById('availability-form');
            const formData = {
                dayOfWeek: form.dayOfWeek.value,
                startTime: form.startTime.value,
                endTime: form.endTime.value,
                isRecurring: form.isRecurring.checked,
                validFrom: form.isRecurring.checked ? null : form.validFrom.value,
                validTo: form.isRecurring.checked ? null : form.validTo.value
            };

            try {
                const response = await fetch(`/api/professionals/${professionalId}/availability`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || 'Failed to save availability');
                }

                const result = await response.json();
                calendar.refetchEvents();
                document.getElementById('availability-modal').classList.add('hidden');
                showToast('Availability saved successfully', 'success');
            } catch (error) {
                console.error('Error saving availability:', error);
                showToast(error.message, 'error');
            }
        }

        // Save service
        async function saveService() {
            const form = document.getElementById('service-form');
            const serviceId = form.dataset.serviceId || null;

            const serviceBody = {
                ProfessionalId    : professionalId,                 // ← MUY importante
                Name              : form.name.value.trim(),
                Description       : form.description.value.trim(),
                Price             : +form.price.value,
                BaseDuration      : +form.baseDuration.value,
                DurationIncrement : +form.durationIncrement.value,
                MaxDuration       : +form.maxDuration.value,
                PriceType         : 'hourly'
            };

            try {
                if (serviceId) {
                await servicesAPI.update(serviceId, serviceBody); 
                } else {
                await servicesAPI.create(serviceBody);           
                }

                await loadProfessionalServices();
                document.getElementById('service-modal').classList.add('hidden');
                showToast(`Service ${serviceId ? 'updated' : 'created'} successfully`, 'success');
            } catch (err) {
                console.error(err);
                showToast(err.message, 'error');
            }
            }


        // Edit service
        async function editService(serviceId) {
            try {
                const response = await fetch(`/api/services/${serviceId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (!response.ok) throw new Error('Failed to load service');
                
                const service = await response.json();
                const form = document.getElementById('service-form');
                
                form.name.value = service.name;
                form.description.value = service.description || '';
                form.price.value = service.pricePerHour;
                form.baseDuration.value = service.baseDuration;
                form.durationIncrement.value = service.durationIncrement;
                form.maxDuration.value = service.maxDuration;
                
                form.dataset.serviceId = serviceId;
                document.querySelector('#service-modal h3').textContent = 'Edit Service';
                document.getElementById('save-service').textContent = 'Update Service';
                
                document.getElementById('service-modal').classList.remove('hidden');
            } catch (error) {
                console.error('Error editing service:', error);
                showToast(error.message, 'error');
            }
        }

        // Delete service
        async function deleteService(serviceId) {
            if (!confirm('Are you sure you want to delete this service? This action cannot be undone.')) return;
            try {
                await servicesAPI.remove(serviceId);   
                await loadProfessionalServices();      
                showToast('Service deleted successfully', 'success');
            } catch (err) {
                console.error(err);
                showToast(err.message, 'error');
            }
            }

        // Open profile modal
        async function openProfileModal() {
            try {
                const response = await fetch('/api/users/me', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    }
                });
                
                if (!response.ok) throw new Error('Failed to load profile');
                
                const userData = await response.json();
                
                // Fill form
                const form = document.getElementById('profile-form');
                form.firstName.value = userData.firstName || '';
                form.lastName.value = userData.lastName || '';
                form.email.value = userData.email || '';
                
                // Professional fields
                if (userData.profession) {
                    form.profession.value = userData.profession || '';
                }
                if (userData.bio) {
                    form.bio.value = userData.bio || '';
                }
                
                document.getElementById('profile-modal').classList.remove('hidden');
            } catch (error) {
                console.error('Error opening profile modal:', error);
                showToast('Error loading profile data', 'error');
            }
        }

        // Save profile
        async function saveProfile() {
            const form = document.getElementById('profile-form');
            const formData = new FormData();
            
            // Add basic data
            formData.append('firstName', form.firstName.value);
            formData.append('lastName', form.lastName.value);
            formData.append('email', form.email.value);
            
            // Add professional fields if they exist
            if (form.profession) formData.append('profession', form.profession.value);
            if (form.bio) formData.append('bio', form.bio.value);
            
            // Add avatar if a new one was selected
            const avatarInput = document.getElementById('avatar-upload');
            if (avatarInput.files[0]) {
                formData.append('profilePicture', avatarInput.files[0]);
            }
            
            try {
                const response = await fetch('/api/users/me', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });
                
                if (!response.ok) throw new Error('Failed to update profile');
                
                const updatedData = await response.json();
                currentUser = updatedData;
                
                // Update UI
                document.getElementById('user-name').textContent = `${updatedData.firstName} ${updatedData.lastName}`;
                document.getElementById('sidebar-user-name').textContent = `${updatedData.firstName} ${updatedData.lastName}`;
                
                if (updatedData.profilePicture) {
                    document.getElementById('user-avatar').src = updatedData.profilePicture;
                    document.getElementById('profile-avatar-preview').src = updatedData.profilePicture;
                }
                
                document.getElementById('profile-modal').classList.add('hidden');
                showToast('Profile updated successfully', 'success');
            } catch (error) {
                console.error('Error saving profile:', error);
                showToast(error.message, 'error');
            }
        }

        // Show appointment details
        function showAppointmentDetails(event) {
            const modal = document.getElementById('appointment-modal');
            
            const appointmentData = {
                id: event.extendedProps.id,
                title: event.title,
                client: event.extendedProps.clientName || 'Client',
                service: event.extendedProps.serviceName || 'Service',
                date: event.start.toLocaleDateString(),
                time: `${event.start.toLocaleTimeString()} - ${event.end.toLocaleTimeString()}`,
                duration: Math.round((event.end - event.start) / (1000 * 60)) + ' min',
                status: event.extendedProps.status || 'pending',
                notes: event.extendedProps.notes || 'No additional notes'
            };

            // Update UI
            document.getElementById('appointment-title').textContent = appointmentData.title;
            document.getElementById('appointment-client').textContent = appointmentData.client;
            document.getElementById('appointment-service').textContent = appointmentData.service;
            document.getElementById('appointment-date').textContent = appointmentData.date;
            document.getElementById('appointment-time').textContent = appointmentData.time;
            document.getElementById('appointment-duration').textContent = appointmentData.duration;
            document.getElementById('appointment-notes').textContent = appointmentData.notes;
            
            // Update status
            const statusElement = document.getElementById('appointment-status');
            statusElement.innerHTML = getStatusBadge(appointmentData.status);
            
            // Configure status button
            const statusBtn = document.getElementById('change-status-btn');
            statusBtn.textContent = getNextStatusAction(appointmentData.status);
            statusBtn.onclick = () => changeAppointmentStatus(appointmentData.id, appointmentData.status);
            
            // Show modal
            modal.classList.remove('hidden');
        }

        // Helper functions for appointment status
        function getStatusBadge(status) {
            const statusMap = {
                'pending': { class: 'bg-yellow-100 text-yellow-800', text: 'Pending' },
                'confirmed': { class: 'bg-green-100 text-green-800', text: 'Confirmed' },
                'cancelled': { class: 'bg-red-100 text-red-800', text: 'Cancelled' },
                'completed': { class: 'bg-blue-100 text-blue-800', text: 'Completed' }
            };
            const statusInfo = statusMap[status.toLowerCase()] || statusMap['pending'];
            return `<span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusInfo.class}">${statusInfo.text}</span>`;
        }

        function getNextStatusAction(currentStatus) {
            const actions = {
                'pending': 'Confirm Appointment',
                'confirmed': 'Mark as Completed',
                'completed': 'Close',
                'cancelled': 'Reactivate Appointment'
            };
            return actions[currentStatus.toLowerCase()] || 'Update Status';
        }

        async function changeAppointmentStatus(appointmentId, currentStatus) {
            try {
                let newStatus;
                switch(currentStatus.toLowerCase()) {
                    case 'pending': newStatus = 'confirmed'; break;
                    case 'confirmed': newStatus = 'completed'; break;
                    case 'cancelled': newStatus = 'pending'; break;
                    default: newStatus = 'completed';
                }

                const response = await fetch(`/api/appointments/${appointmentId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({ status: newStatus })
                });

                if (!response.ok) throw new Error('Failed to update status');

                // Close modal and refresh calendar
                document.getElementById('appointment-modal').classList.add('hidden');
                calendar.refetchEvents();
                showToast(`Status updated to ${newStatus}`, 'success');

            } catch (error) {
                console.error('Error:', error);
                showToast(`Error: ${error.message}`, 'error');
            }
        }

        // Show availability details
        function showAvailabilityDetails(event) {
            // Implement this function if needed
            console.log('Availability details:', event);
        }

        // Reset service form
        function resetServiceForm() {
            const form = document.getElementById('service-form');
            form.reset();
            delete form.dataset.serviceId;
            document.querySelector('#service-modal h3').textContent = 'Add New Service';
            document.getElementById('save-service').textContent = 'Save Service';
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            // Simple implementation using alert - replace with a proper toast notification in production
            alert(`${type.toUpperCase()}: ${message}`);
        }

        function logout () {
            clearAuth();
            window.location.href = '../login.html';
        }

    </script>
</body>
</html>